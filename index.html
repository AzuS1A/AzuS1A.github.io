<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<title>一言 + 聊天室</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
/* ===== 通用字体 ===== */
@font-face{
  font-family:"FZLanLight";
  src:url("./FZLanLight.TTF") format("truetype");
}
@font-face{
  font-family:"FZLanHeavy";
  src:url("./FZLanHeavy.TTF") format("truetype");
}

/* ===== 全局 ===== */
*{margin:0;padding:0;box-sizing:border-box}
body{
  min-height:100vh;
  background:linear-gradient(135deg,#e6f2ff,#f8fbff) fixed;
  background-image:url("./main.png");
  font-family:FZLanLight;
  color:#333;
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* ===== 左侧面板 ===== */
.left-panel{
  width:30vw;
  background:#fff;
  box-shadow:2px 0 10px rgba(0,0,0,.1);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}
.left-header{
  background:#007bff;
  color:#fff;
  padding:15px;
  font-weight:bold;
  font-size:1.2em;
}
.quote-list{
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.quote-item{
  padding:12px;
  margin-bottom:8px;
  background:#f5f5f5;
  border-radius:8px;
  cursor:pointer;
  transition:all .3s;
  border-left:3px solid transparent;
}
.quote-item:hover{
  background:#e6f2ff;
  border-left-color:#007bff;
}
.quote-item.active{
  background:#e6f2ff;
  border-left-color:#007bff;
}
.quote-text{
  font-size:.9em;
  color:#333;
  margin-bottom:5px;
}
.quote-author{
  font-size:.8em;
  color:#666;
}
.quote-category{
  font-size:.7em;
  color:#007bff;
  margin-top:3px;
}

/* ===== 右侧聊天区 ===== */
.right-panel{
  flex:1;
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* ===== 聊天室 ===== */
.chat-container {
  width: 100%;
  height: 100%;
  background: #fff;
  display: flex;
  flex-direction: column;
  box-shadow: 0 2px 10px rgba(0, 0, 0, .1);
  overflow: hidden;
}
.chat-header{
  background:#ffffff;
  color:#00aaff;
  padding:15px;
  text-align:center;
  font-weight:bold
}
.messages-container {
  flex: 1 1 auto;
  overflow-y: auto;
  padding: 20px;
  background: #fafafa;
}
button{
    margin-top:12px;
    background:#00aaff;
    border:none;
    padding:8px 18px;
    border-radius:12px;
    color:#fff;
    font-size:1em;
    cursor:pointer;
  }
.message{display:flex;margin-bottom:15px;align-items:flex-start}
.message.own{flex-direction:row-reverse}
.avatar{width:40px;height:40px;border-radius:50%;margin:0 10px;object-fit:cover;border:2px solid #e0e0e0}
.message-content{max-width:70%;background:#fff;padding:10px 15px;border-radius:18px;box-shadow:0 1px 2px rgba(0,0,0,.1);word-break:break-all}
.message.own .message-content{background:#007bff;color:#fff}
.message img,.message video{max-width:100%;max-height:300px;border-radius:10px;cursor:pointer}
.message-info{font-size:12px;color:#666;margin-top:5px}
.message.own .message-info{color:#ccc}
.input-container{padding:15px;border-top:1px solid #eee;display:flex;gap:10px}
.input-container input{flex:1;padding:10px;border:1px solid #ddd;border-radius:20px;outline:none}
.input-container button,.file-label,#sendBtn{padding:10px 18px;border:none;background:#007bff;color:#fff;border-radius:20px;cursor:pointer;font-size:14px}
.input-container button:hover,.file-label:hover,#sendBtn:hover{background:#0056b3}
.file-input{display:none}

/* ===== 加载遮罩 ===== */
#loader{
  position:fixed;inset:0;background:#fff;display:flex;justify-content:center;align-items:center;
  z-index:9999;font-size:1.5em;color:#0066cc;transition:opacity .5s
}

.blink {
  animation: blink 0.07s 3;
}
@keyframes blink {
  0% { opacity: 1; }
  50% { opacity: 0; }
  100% { opacity: 1; }
}

/* ===== 左下角滚动提示 ===== */
:root{
  --dotColor:#000;--dotActive:#93cbff;
  --dotW:21px;--dotH:5px;--dotGap:5px;--textColor:#000;
}
.scroll-hint{position:fixed;right:20px;top:20px;display:flex;flex-direction:column;pointer-events:none;z-index:999}
.pointList{display:flex;gap:var(--dotGap)}
.point{width:var(--dotW);height:var(--dotH);background:var(--dotColor);opacity:.1;transform:skew(-30deg);transition:all .01s}
.point.active{background:var(--dotActive);opacity:1;}
.scroll-hint .text{margin-top:10px;font-size:11px;letter-spacing:.1em;color:var(--textColor);opacity:.01}
</style>
</head>
<body>

<!-- ========== 加载遮罩 ========== -->
<div id="loader">少女加载中...</div>

<div class="left-panel">
  <div class="left-header">
    <h2>工具列表</h2>
  </div>
  <div class="quote-list" id="quoteList">
    <!-- 当前随机一言 -->
    <div class="quote-item" active id="currentQuote">
    <h2 style="font-size: medium;">📜 一言
      <div style="font-size: medium;" class="quote-text blink-area" id="sentence"></div>
      <div style="font-size: medium;" class="quote-author" id="author"></div>
      <div style="font-size: medium;" class="quote-category" id="category"></div>
      <button onclick="newQuote()" style="font-size: medium;">换一句</button></h2>
    </div>
    <!-- 当前今日人品 -->
    <div class="quote-item" active id="jrrp"><h2>
        <div style="font-size: medium;" class="quote-text blink-area2" id="jrrp">还没获取今日人品哦</div>
        <button onclick="jrrp()" style="font-size: medium;">今日人品</button></h2>
      </div>
  </div>
</div>

<!-- ========== 右侧聊天区 ========== -->
<div class="right-panel" id="chatBox">
  <div class="chat-container">
    <div class="chat-header" style="text-align: left;"><h2>WebSocket Chat</h2></div>
    <div class="messages-container" id="msgs"></div>
    <div class="input-container">
      <input id="input" type="text" placeholder="输入消息..." autocomplete="off">
      <input id="file" type="file" accept="image/*,video/*" class="file-input">
      <label for="file" class="file-label" style="font-family: FZLanHeavy;">文件</label>
      <label id="sendBtn" style="font-family: FZLanHeavy;">发送</label>
    </div>
  </div>
</div>

<!-- ========== 左下角滚动提示 ========== -->
<div class="scroll-hint">
  <div class="pointList" id="dots"></div>
  <h2 style="text-align: right;color: #666;font-size: medium;">SCROLL</h2>
</div>

<script>
/* ========== 金句数据 ========== */
const data = {
  "金句": [
    {"句子":"生活不是等待暴风雨过去，而是学会在雨中跳舞。","作者":"——维克多·雨果"},
    {"句子":"不要因为结束而哭泣，微笑吧，为你的曾经拥有。","作者":"——加布里埃尔·加西亚·马尔克斯"},
    {"句子":"成功是跌倒九次，站起十次。","作者":"——拿破仑·希尔"},
    {"句子":"我们唯一真正的限制，是我们自己心中的恐惧。","作者":"——弗兰克林·罗斯福"},
    {"句子":"当你停止追求完美，你才能找到真正的幸福。","作者":"——阿尔伯特·爱因斯坦"},
    {"句子":"在黑暗中点亮一盏灯，就是对抗黑暗的最好方式。","作者":"——马丁·路德·金"},
    {"句子":"未来属于那些相信自己梦想之美的人。","作者":"——埃莉诺·罗斯福"},
    {"句子":"勇气不是没有恐惧，而是面对恐惧仍然前进。","作者":"——纳尔逊·曼德拉"},
    {"句子":"人的一生只有一次机会，成功靠坚持。","作者":"——乔治·桑塔亚纳"},
    {"句子":"最困难的时候，就是离成功不远的时候。","作者":"——托马斯·爱迪生"},
    {"句子":"想象力比知识更重要。","作者":"——阿尔伯特·爱因斯坦"},
    {"句子":"生活中最大的荣耀不在于永不跌倒，而在于每次跌倒后都能站起来。","作者":"——孔子"},
    {"句子":"只有经历地狱般的磨练，才能炼出创造天堂的力量。","作者":"——泰戈尔"},
    {"句子":"时间是最公平的裁判，真理终将胜利。","作者":"——弗朗西斯·培根"},
    {"句子":"你若盛开，清风自来。","作者":"——徐志摩"},
    {"句子":"改变世界的不是力量，而是坚持。","作者":"——约翰·肯尼迪"},
    {"句子":"每一次的失败，都是通向成功的阶梯。","作者":"——温斯顿·丘吉尔"},
    {"句子":"命运掌握在你自己手中。","作者":"——威廉·莎士比亚"},
    {"句子":"你必须成为你希望看到的改变。","作者":"——马哈蒂尔·甘地"},
    {"句子":"理想是指路明灯，信念是坚定的船桨。","作者":"——巴尔扎克"},
    {"句子":"最伟大的荣耀不是从未失败，而是每次跌倒后都能重新站起来。","作者":"——孔子"},
    {"句子":"不积跬步，无以至千里。","作者":"——荀子"},
    {"句子":"幸福不是拥有的多，而是计较的少。","作者":"——威廉·莎士比亚"},
    {"句子":"生命的意义在于追求卓越，而非平庸。","作者":"——阿诺德·格拉斯哥"},
    {"句子":"世上无难事，只怕有心人。","作者":"——鲁迅"},
    {"句子":"成功的秘诀在于恒心。","作者":"——塞缪尔·约翰逊"},
    {"句子":"所有伟大的改变，都是从自己做起。","作者":"——列夫·托尔斯泰"},
    {"句子":"行动是治愈恐惧的良药。","作者":"——戴尔·卡耐基"},
    {"句子":"最困难的时候，就是最接近成功的时候。","作者":"——托马斯·爱迪生"},
    {"句子":"梦想一旦被理解，就变成了目标。","作者":"——奥普拉·温弗瑞"},
    {"句子":"你无法控制风向，但你可以调整帆。","作者":"——吉米·迪恩"},
    {"句子":"保持简单，保持真实。","作者":"——史蒂夫·乔布斯"},
    {"句子":"最大的冒险就是不冒任何风险。","作者":"——马克·扎克伯格"},
    {"句子":"让自己变得更好，而不是变得更忙。","作者":"——约翰·伍登"},
    {"句子":"有信念的人，无论遭遇何种挫折都不会倒下。","作者":"——巴勃罗·毕加索"},
    {"句子":"心态决定高度。","作者":"——威尔·史密斯"},
    {"句子":"不要被过去的错误定义未来。","作者":"——欧普拉·温弗瑞"},
    {"句子":"相信自己，永不放弃。","作者":"——迈克尔·乔丹"},
    {"句子":"你不能期待收获，却不耕耘。","作者":"——肯尼斯·布兰查德"},
    {"句子":"成功属于不断努力的人。","作者":"——安德鲁·卡内基"},
    {"句子":"失败是成功之母。","作者":"——托马斯·爱迪生"},
    {"句子":"知识改变命运。","作者":"——弗朗西斯·培根"},
    {"句子":"真正的自由是内心的平静。","作者":"——弗里德里希·尼采"},
    {"句子":"每个人都是自己命运的建筑师。","作者":"——威廉·莎士比亚"},
    {"句子":"用心生活，热爱生命。","作者":"——亨利·戴维·梭罗"},
    {"句子":"过去属于死神，未来属于你自己。","作者":"——雪莱"},
    {"句子":"理想的实现始于信念。","作者":"——拿破仑·波拿巴"},
    {"句子":"生活是一面镜子，你对它笑，它也会对你笑。","作者":"——威廉·詹姆斯"},
    {"句子":"耐心和坚持是成功的关键。","作者":"——约翰·洛克菲勒"},
    {"句子":"想象力是智慧的开始。","作者":"——乔治·伯纳德·肖"},
    {"句子":"只有行动才能驱散恐惧。","作者":"——弗兰克林·罗斯福"},
    {"句子":"人生最大的荣耀不在于从不失败，而在于每次跌倒后都能站起来。","作者":"——尼尔森·曼德拉"},
    {"句子":"成功就是不断向失败挑战的过程。","作者":"——温斯顿·丘吉尔"},
    {"句子":"努力是天才的唯一秘方。","作者":"——阿尔贝·加缪"},
    {"句子":"每天进步一点点。","作者":"——孔子"},
    {"句子":"无奋斗，不青春。","作者":"——海明威"},
    {"句子":"伟大的思想源于伟大的梦想。","作者":"——马丁·路德·金"},
    {"句子":"自由是灵魂的呼吸。","作者":"——萨特"},
    {"句子":"你不能选择风向，但可以调整帆。","作者":"——吉米·迪恩"},
    {"句子":"成功不在于从不失败，而在于永不放弃。","作者":"——查尔斯·狄更斯"},
    {"句子":"信念创造奇迹。","作者":"——乔治·华盛顿"},
    {"句子":"梦想是人生的航标。","作者":"——海伦·凯勒"},
    {"句子":"生命的意义在于不断成长。","作者":"——卡尔·荣格"},
    {"句子":"行动是通向成功的桥梁。","作者":"——拉尔夫·瓦尔多·爱默生"},
    {"句子":"学会感恩，拥抱生活。","作者":"——艾默生"},
    {"句子":"知识就是力量。","作者":"——培根"},
    {"句子":"未来属于有准备的人。","作者":"——路易·巴斯德"},
    {"句子":"唯有改变才能永恒。","作者":"——赫拉克利特"},
    {"句子":"每天都是新的开始。","作者":"——托尔斯泰"},
    {"句子":"做你害怕做的事，恐惧就会消失。","作者":"——拉尔夫·瓦尔多·爱默生"},
    {"句子":"一切皆有可能，只要你相信。","作者":"——沃尔特·迪士尼"},
    {"句子":"成功不是终点，失败不是终结，最重要的是继续前进的勇气。","作者":"——温斯顿·丘吉尔"}
  ],

  "名言警句": [
    {"句子":"己所不欲，勿施于人。","作者":"——孔子"},
    {"句子":"读万卷书，行万里路。","作者":"——刘彝"},
    {"句子":"天行健，君子以自强不息。","作者":"——《易经》"},
    {"句子":"学而不思则罔，思而不学则殆。","作者":"——孔子"},
    {"句子":"敏而好学，不耻下问。","作者":"——孔子"},
    {"句子":"海纳百川，有容乃大。","作者":"——林则徐"},
    {"句子":"君子坦荡荡，小人长戚戚。","作者":"——孔子"},
    {"句子":"知足者常乐。","作者":"——老子"},
    {"句子":"以人为镜，可以明得失。","作者":"——曾国藩"},
    {"句子":"天道酬勤。","作者":"——《礼记》"},
    {"句子":"厚德载物。","作者":"——《易经》"},
    {"句子":"不忘初心，方得始终。","作者":"——近现代"},
    {"句子":"学无止境。","作者":"——荀子"},
    {"句子":"立身以立学为先。","作者":"——欧阳修"},
    {"句子":"自强不息。","作者":"——《易经》"},
    {"句子":"有志者事竟成。","作者":"——诸葛亮"},
    {"句子":"敏而好学，不耻下问。","作者":"——孔子"},
    {"句子":"勿以恶小而为之，勿以善小而不为。","作者":"——刘备"},
    {"句子":"百尺竿头，更进一步。","作者":"——宋·陆游"},
    {"句子":"业精于勤，荒于嬉。","作者":"——韩愈"},
    {"句子":"宁为玉碎，不为瓦全。","作者":"——文天祥"},
    {"句子":"滴水穿石，绳锯木断。","作者":"——《增广贤文》"},
    {"句子":"千里之行，始于足下。","作者":"——老子"},
    {"句子":"谋事在人，成事在天。","作者":"——中国谚语"},
    {"句子":"学而时习之，不亦说乎？","作者":"——孔子"},
    {"句子":"天道酬勤，厚德载物。","作者":"——中国传统"},
    {"句子":"良药苦口利于病，忠言逆耳利于行。","作者":"——李时珍"},
    {"句子":"自律给我自由。","作者":"——亚里士多德"},
    {"句子":"诚者，天之道也；思诚者，人之道也。","作者":"——荀子"}
  ],

  "毛泽东语录": [
    {"句子":"一切反动派都是纸老虎。","作者":"——毛泽东"},
    {"句子":"为人民服务。","作者":"——毛泽东"},
    {"句子":"革命不是请客吃饭。","作者":"——毛泽东"},
    {"句子":"枪杆子里面出政权。","作者":"——毛泽东"},
    {"句子":"星星之火，可以燎原。","作者":"——毛泽东"},
    {"句子":"自力更生，艰苦奋斗。","作者":"——毛泽东"},
    {"句子":"没有调查就没有发言权。","作者":"——毛泽东"},
    {"句子":"学会斗争，善于斗争。","作者":"——毛泽东"},
    {"句子":"世界是你们的，也是我们的，但归根结底是你们的。","作者":"——毛泽东"},
    {"句子":"抓革命，促生产。","作者":"——毛泽东"},
    {"句子":"群众是真正的英雄。","作者":"——毛泽东"},
    {"句子":"实践是检验真理的唯一标准。","作者":"——毛泽东"},
    {"句子":"枪杆子里出政权。","作者":"——毛泽东"},
    {"句子":"没有调查，没有发言权。","作者":"——毛泽东"},
    {"句子":"党指挥枪。","作者":"——毛泽东"},
    {"句子":"自力更生，奋发图强。","作者":"——毛泽东"},
    {"句子":"人民，只有人民，才是创造世界历史的动力。","作者":"——毛泽东"},
    {"句子":"打扫干净屋子，才能住得舒服。","作者":"——毛泽东"},
    {"句子":"敌人一天天烂下去，我们一天天好起来。","作者":"——毛泽东"},
    {"句子":"斗争哲学。","作者":"——毛泽东"},
    {"句子":"时间就是生命。","作者":"——毛泽东"},
    {"句子":"愚公移山。","作者":"——毛泽东"},
    {"句子":"要敢于斗争，敢于胜利。","作者":"——毛泽东"},
    {"句子":"理论联系实际。","作者":"——毛泽东"},
    {"句子":"群众路线。","作者":"——毛泽东"},
    {"句子":"艰苦奋斗。","作者":"——毛泽东"},
    {"句子":"胜利属于最坚韧的人。","作者":"——毛泽东"},
    {"句子":"自信人生二百年，会当水击三千里。","作者":"——毛泽东"},
    {"句子":"敢教日月换新天。","作者":"——毛泽东"}
  ],

  "邓小平语录": [
    {"句子":"发展是硬道理。","作者":"——邓小平"},
    {"句子":"实践是检验真理的唯一标准。","作者":"——邓小平"},
    {"句子":"不管白猫黑猫，抓住老鼠就是好猫。","作者":"——邓小平"},
    {"句子":"让一部分人先富起来。","作者":"——邓小平"},
    {"句子":"改革开放，是中国的第二次革命。","作者":"——邓小平"},
    {"句子":"科学技术是第一生产力。","作者":"——邓小平"},
    {"句子":"建设有中国特色社会主义。","作者":"——邓小平"},
    {"句子":"发展才是硬道理。","作者":"——邓小平"},
    {"句子":"走自己的路，让别人说去吧。","作者":"——邓小平"},
    {"句子":"做好自己的事，就是爱国。","作者":"——邓小平"},
    {"句子":"计划经济不等于计划，没有计划不能搞建设。","作者":"——邓小平"},
    {"句子":"改革是中国的第二次革命。","作者":"——邓小平"},
    {"句子":"社会主义初级阶段是长期的。","作者":"——邓小平"},
    {"句子":"市场经济不是资本主义。","作者":"——邓小平"},
    {"句子":"和平与发展是时代的主题。","作者":"——邓小平"},
    {"句子":"稳定压倒一切。","作者":"——邓小平"},
    {"句子":"不改革就会死。","作者":"——邓小平"},
    {"句子":"国家必须富强，人民才会幸福。","作者":"——邓小平"},
    {"句子":"社会稳定是经济发展的前提。","作者":"——邓小平"},
    {"句子":"人民的利益高于一切。","作者":"——邓小平"}
  ],

  "游戏精选": [
    {"句子":"War. War never changes. - 战争。战争永远不会改变。","作者":"——Fallout 系列"},
    {"句子":"The right man in the wrong place can make all the difference in the world. - 错位的对的人能改变整个世界。","作者":"——Half-Life 2"},
    {"句子":"It's dangerous to go alone! Take this. - 一个人去很危险！拿着这个。","作者":"——塞尔达传说"},
    {"句子":"I used to be an adventurer like you, then I took an arrow in the knee. - 我曾经也是像你一样的冒险者，后来我膝盖中了一箭。","作者":"——上古卷轴V：天际"},
    {"句子":"Stay a while and listen. - 停下来，听我说。","作者":"——暗黑破坏神II"},
    {"句子":"You have died of dysentery. - 你死于痢疾。","作者":"——俄勒冈之旅"},
    {"句子":"Finish him! - 击倒他！","作者":"——真人快打"},
    {"句子":"Do a barrel roll! - 做一个桶滚！","作者":"——星际火狐"},
    {"句子":"Hadouken! - 波动拳！","作者":"——街头霸王"},
    {"句子":"The cake is a lie. - 蛋糕是谎言。","作者":"——传送门"},
    {"句子":"Would you kindly...? - 你能否请……？","作者":"——生化奇兵"},
    {"句子":"Praise the sun! - 赞美太阳！","作者":"——黑暗之魂"},
    {"句子":"I am error. - 我是错误。","作者":"——泽尔达传说II"},
    {"句子":"War never changes. - 战争永远不会改变。","作者":"——辐射"},
    {"句子":"Stay sharp. - 保持警惕。","作者":"——使命召唤系列"},
    {"句子":"Get over here! - 过来这里！","作者":"——真人快打"},
    {"句子":"It's-a me, Mario! - 我是马里奥！","作者":"——超级马里奥"},
    {"句子":"Snake? Snake?! SNAAAAKE!!! - 蛇？蛇？！蛇！！","作者":"——合金装备"},
    {"句子":"Would you like a peanut? - 你想要个花生吗？","作者":"——猴岛小英雄"},
    {"句子":"Praise the sun! - 赞美太阳！","作者":"——黑暗之魂"},
    {"句子":"Remember, no Russian. - 记住，别开枪，除了俄罗斯人。","作者":"——Call of Duty: Modern Warfare 2"},
    {"句子":"The healthy human mind doesn't wake up in the morning thinking this is its last day on Earth. - 健康的人脑不会早晨醒来，认为今天是生命的最后一天。","作者":"——Call of Duty: Modern Warfare 2"},
    {"句子":"We fight or we die. That's the mission. - 我们战斗，或者死去。这就是使命。","作者":"——Call of Duty: Black Ops"},
    {"句子":"No man gets left behind. Not on my watch. - 没有人会被遗弃。至少在我这里不会。","作者":"——Call of Duty 系列"},
    {"句子":"Frag out! Get ready to rumble! - 手榴弹发射！准备好厮杀！","作者":"——Call of Duty 系列"},
    {"句子":"This is just the beginning. The real fight starts now. - 这才刚开始，真正的战斗现在才开始。","作者":"——Call of Duty: Modern Warfare"},
    {"句子":"Get down! Incoming fire! - 趴下！敌火来袭！","作者":"——Call of Duty 系列"},
    {"句子":"Time to make some noise and show them who we are. - 是时候制造点动静，告诉他们我们是谁了。","作者":"——Call of Duty 系列"},
    {"句子":"We're the tip of the spear, the first through the breach. - 我们是矛尖，冲锋的第一波。","作者":"——Call of Duty: Modern Warfare"},
    {"句子":"Mission accomplished. Let's head home. - 任务完成，回家吧。","作者":"——Call of Duty 系列"},
    {"句子":"You are never alone in this fight, soldier. Watch your six. - 在这场战斗中你永远不会孤单，战士。注意背后。","作者":"——Call of Duty: Ghosts"},
    {"句子":"Eyes open, boys. Danger's everywhere. - 睁大眼睛，伙计们，危险无处不在。","作者":"——Call of Duty 系列"},
    {"句子":"Hold the line! We stand or we fall together. - 坚守阵地！我们同生共死。","作者":"——Call of Duty 系列"},
    {"句子":"Cover me! Moving up! - 掩护我！我前进了！","作者":"——Call of Duty 系列"},
    {"句子":"We're going loud. No holding back. - 我们全力开火，毫无保留。","作者":"——Call of Duty 系列"},
    {"句子":"Lock and load. The enemy won't wait. - 装填弹药，敌人不会等我们。","作者":"——Call of Duty 系列"},
    {"句子":"Stay sharp. One mistake and it's over. - 保持警惕，一个错误就是终结。","作者":"——Call of Duty 系列"},
    {"句子":"Enemy down. Keep pushing forward. - 敌人倒下了，继续前进。","作者":"——Call of Duty 系列"},
    {"句子":"No retreat, no surrender. This is our fight. - 不退缩，不投降。这是我们的战斗。","作者":"——Call of Duty 系列"},
    {"句子":"This war will define us all. Make it count. - 这场战争将定义我们所有人，好好把握。","作者":"——Call of Duty 系列"},
    {"句子":"所在皆是奇迹的起点","作者":"——蔚蓝档案"},
    {"句子":"即便凡事都是虚空，今天的事也必须在今天全力以赴。","作者":"——蔚蓝档案"},
    {"句子":"勇者的冒险是从前进开始的。","作者":"——蔚蓝档案"},
    {"句子":"重要的不是经验，是选择。","作者":"——蔚蓝档案"},
    {"句子":"你想成为什么样的存在，由你自己决定。","作者":"——蔚蓝档案"},
    {"句子":"资格不是别人给的，是自己创造出来的。","作者":"——蔚蓝档案"},
    {"句子":"一定能找到，通往与这扭曲的终点所截然不同的，另一种结局的正确选项。","作者":"——蔚蓝档案"},
    {"句子":"勇气是在黑夜中重新点燃火焰。","作者":"——蔚蓝档案"}
  ]
};

/* ========== 一言逻辑 ========== */
let allQuotes=[];
for(const c in data) data[c].forEach(q=>allQuotes.push({句子:q.句子,作者:q.作者,类别:c}));

function newQuote() {
  const area = document.querySelector('.blink-area');
  area.classList.add('blink');
  setTimeout(() => area.classList.remove('blink'), 400);

  const idx = Math.floor(Math.random() * allQuotes.length);
  const quote = allQuotes[idx];
  document.getElementById('sentence').textContent = quote.句子;
  document.getElementById('author').textContent = quote.作者;
  document.getElementById('category').textContent = quote.类别;
}
window.addEventListener('load', newQuote);

function jrrp() {
  const area = document.querySelector('.blink-area2');
  area.classList.add('blink');
  setTimeout(() => area.classList.remove('blink'), 400);

  const idx = Math.floor(Math.random() * allQuotes.length);
  const quote = allQuotes[idx];
  let currentTimeMillis = Date.now();
  document.getElementById('jrrp').textContent = "今日人品："+ currentTimeMillis % 1000 /10;
}

/* ========== 聊天室 ========== */
class Chat {
  constructor(opts = {}) {
    this.wsUrl = opts.wsUrl || 'ws://127.0.0.1:8765';
    this.user  = opts.user  || '用户' + Math.floor(Math.random() * 1000);
    this.room  = opts.room  || 'default';
    this.avatar= opts.avatar|| './headimg.avif';
    this.init();
  }

  init() {
    // 1) 先隐藏聊天区域
    this.chatBox   = document.getElementById('chatBox'); // 整个聊天窗口
    this.chatBox.style.display = 'none';

    this.msgs   = document.getElementById('msgs');
    this.input  = document.getElementById('input');
    this.file   = document.getElementById('file');
    this.connect();
    this.bindEvents();
  }

  connect() {
    this.ws = new WebSocket(`${this.wsUrl}?user=${encodeURIComponent(this.user)}&room=${encodeURIComponent(this.room)}`);

    this.ws.onopen = () => {
      this.addInfo('已连接');
      this.chatBox.style.display = '';        // 2) 连上后显示
    };

    this.ws.onclose = () => {
      this.addInfo('断开，3s后重连');
      this.chatBox.style.display = 'none';    // 3) 断线后隐藏
      setTimeout(() => this.connect(), 3000);
    };

    this.ws.onmessage = e => this.handle(JSON.parse(e.data));
  }

  bindEvents() {
    document.getElementById('sendBtn').addEventListener('click', () => this.sendText());
    this.input.addEventListener('keyup', e => { if (e.key === 'Enter') this.sendText(); });
    this.file.addEventListener('change', e => this.sendFile(e.target.files[0]));
  }

  sendText() {
    const txt = this.input.value.trim();
    if (!txt) return;
    this.ws.send(JSON.stringify({ type: 'chat', user: this.user, msg: txt, avatar: this.avatar }));
    this.input.value = '';
  }

  sendFile(file) {
    if (!file) return;
    const isImg = file.type.startsWith('image/');
    const isVid = file.type.startsWith('video/');
    if (!isImg && !isVid) { alert('仅支持图片/视频'); return; }
    const max = isImg ? 12 : 29;
    if (file.size > max * 1024 * 1024) { alert(`${isImg ? '图片' : '视频'}不能超${max}MB`); return; }
    const reader = new FileReader();
    reader.onload = e => {
      this.ws.send(JSON.stringify({
        type: 'chat', user: this.user, msg: e.target.result,
        avatar: this.avatar, is_image: isImg, is_video: isVid
      }));
    };
    reader.readAsDataURL(file);
    this.file.value = '';
  }

  handle(d) {
    if (d.type === 'chat') this.addMsg(d);
    else this.addInfo(`${d.user} ${d.type === 'user_joined' ? '加入' : '离开'}`);
  }

  addMsg({ user, msg, avatar, is_image, is_video, time }) {
    const own = user === this.user;
    const el = document.createElement('div');
    el.className = 'message ' + (own ? 'own' : '');
    let media = '';
    if (is_image)      media = `<img src="${msg}" alt="图" onclick="window.open('${msg}')"/>`;
    else if (is_video) media = `<video controls style="max-width:100%;max-height:300px;border-radius:10px"><source src="${msg}"></video>`;
    else               media = msg;
    el.innerHTML = `<img class="avatar" src="${avatar}"/><div class="message-content">${media}<div class="message-info">${user} · ${new Date(time).toLocaleTimeString()}</div></div>`;
    this.msgs.appendChild(el);
    this.msgs.scrollTop = this.msgs.scrollHeight;
  }

  addInfo(txt) {
    const div = document.createElement('div');
    div.style.cssText = 'text-align:center;color:#666;font-size:12px;margin:5px 0';
    div.textContent = txt;
    this.msgs.appendChild(div);
    this.msgs.scrollTop = this.msgs.scrollHeight;
  }
}

/* ========== 初始化 ========== */
window.addEventListener('load', () => {
  const params = new URLSearchParams(location.search);
  new Chat({
    wsUrl: params.get('ws') || 'ws://127.0.0.1:8765',
    user:  params.get('user') || '用户' + Math.floor(Math.random() * 1000),
    room:  params.get('room') || 'default',
    avatar:params.get('avatar') || './headimg.avif'
  });

  
  // 关闭加载遮罩
  const l=document.getElementById('loader');
  l.style.opacity=0;
  setTimeout(()=>l.remove(),500);
});

/* ========== 滚动提示 ========== */
const dotsBox=document.getElementById('dots');
for(let i=0;i<10;i++){const d=document.createElement('span');d.className='point';dotsBox.appendChild(d);}
const dots=document.querySelectorAll('.point');
let di=0; dots[0].classList.add('active');
setInterval(()=>{
  dots[di].classList.remove('active');
  di=(di+1)%dots.length;
  dots[di].classList.add('active');
},200);
</script>
</body>
</html>